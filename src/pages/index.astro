---
import Layout from '@layouts/Layout.astro';
import Intro from '@components/Intro.astro';
import ProjectCard from '@components/ProjectCard.astro';
import Contact from '@components/Contact.astro';
import { getCollection } from 'astro:content';

/* ===============================
   Load & sort projects safely
================================ */
const allProjects = (await getCollection('projects')).sort((a, b) => a.data.order - b.data.order);

/* ===============================
   Page 1: Intro + 2 projects
================================ */
const firstPageProjects = allProjects.slice(0, 2);

/* ===============================
   Remaining projects
================================ */
const remainingProjects = allProjects.slice(2);

/* ===============================
   Split remaining projects into pages of 3
================================ */
const projectPages = [];
for (let i = 0; i < remainingProjects.length; i += 3) {
	projectPages.push(remainingProjects.slice(i, i + 3));
}
---

<Layout>
	<main class="h-screen snap-y snap-mandatory overflow-y-scroll">
		<!-- =========================
         PAGE 1: INTRO + 2 PROJECTS
    ========================== -->
		<section class="grid h-screen snap-start grid-cols-3">
			<Intro />

			{firstPageProjects.map((project) => <ProjectCard project={project} />)}
		</section>

		<!-- =========================
         MIDDLE PAGES: 3 PROJECTS
    ========================== -->
		{
			projectPages.slice(0, -1).map((page) => (
				<section class="grid h-screen snap-start grid-cols-3">
					{page.map((project) => (
						<ProjectCard project={project} />
					))}
				</section>
			))
		}

		<!-- =========================
         LAST PAGE: 2 PROJECTS + CONTACT
    ========================== -->
		{
			projectPages.length > 0 && (
				<section class="grid h-screen snap-start grid-cols-3">
					{projectPages[projectPages.length - 1].slice(0, 2).map((project) => (
						<ProjectCard project={project} />
					))}

					<Contact />
				</section>
			)
		}
	</main>
</Layout>
